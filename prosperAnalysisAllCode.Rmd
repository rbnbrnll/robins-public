---
title: "ProsperLoanData Analysis"
author: "Robin"
date: "September 9, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Prosper Loan Data Exploration by Robin Garrow

This report explores a dataset containing amounts, APR, and personal financial information for approximately 85,000 loans over 5 years.

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}

library(ggplot2)
library(dplyr)
library(lubridate)
library(gridExtra)
library(tidyr)
library(doBy)
library(corrplot)

```
```{r echo=FALSE, warning=FALSE, Load_the_Data}
# Set the working directory and load the Prosper data
setwd("T:/UdacityDesktop/R_and_EDA/EDA_Course_Materials/finalproject")
pd <- read.csv("prosperloandata.csv")
dim(pd)
```


The data contains eighty one variables.  I hope to determine what other factors besides Prosper Rating may indicate whether or not a borrower will default or miss payments on a loan.  Prosper Rating was not added to the data until 2009 so for this analysis I will take a subset of the data to include only records where the Propser Rating exists and loans that have not been cancelled.  I am intentionally displaying data manipulations here per the submission guidelines.

```{r warning=FALSE, subset_data}
# Intentionally display this section in the report so data manipulations can be
# observed.
# subset the Prosper Data to capture data of interest and exclude cancelled 
#loans

spd <- subset(pd, LoanStatus != "Cancelled" & !is.na(ProsperRating..numeric.), 
              select = c(Term, LoanStatus, BorrowerAPR, ProsperRating..numeric.,
                         ProsperRating..Alpha., ListingCategory..numeric.,
                         Occupation, IsBorrowerHomeowner, CreditScoreRangeLower,
                         CreditScoreRangeUpper, CurrentCreditLines, 
                         CurrentDelinquencies, DebtToIncomeRatio, IncomeRange,
                         LoanOriginalAmount, LoanOriginationDate))
dim(spd)
summary(spd)

# Convert Loan Origination Date from factor to more usable date
spd$LoanDate <- as.Date(ymd_hms(spd$LoanOriginationDate))

# Rearrange the order of the Loan status rather than leaving it in alphabetical 
# order
spd$LoanStatus <- ordered(spd$LoanStatus, levels = c("Completed", 
                                                     "FinalPaymentInProgress",
                                                     "Current", 
                                                     "Past Due (1-15 days)", 
                                                     "Past Due (16-30 days)",
                                                     "Past Due (31-60 days)",
                                                     "Past Due (61-90 days)",
                                                     "Past Due (91-120 days)",
                                                     "Past Due (>120 days)", 
                                                     "Chargedoff", 
                                                     "Defaulted" ))

# Add an numeric field and set the value to a corresponding LoanStatus value, 
# 0 is the best and 8 is the worst
spd$StatusCode <- NA
spd <- within(spd, {
  StatusCode[LoanStatus == "Completed" | 
               LoanStatus == "FinalPaymentInProgress"] <- 0 
  StatusCode[LoanStatus == "Current"] <- 1
  StatusCode[LoanStatus == "Past Due (1-15 days)"] <- 2
  StatusCode[LoanStatus == "Past Due (16-30 days)"] <- 3
  StatusCode[LoanStatus == "Past Due (31-60 days)"] <- 4
  StatusCode[LoanStatus == "Past Due (61-90 days)"] <- 5
  StatusCode[LoanStatus == "Past Due (91-120 days)"] <- 6
  StatusCode[LoanStatus == "Past Due (>120 days)"] <- 7
  StatusCode[LoanStatus == "Chargedoff" | LoanStatus == "Defaulted"] <- 8
  }
  )


# Rearrange order of income range so it makes sense when displayed graphically
spd$IncomeRange <- ordered(spd$IncomeRange, levels = c("Not employed", 
                                                       "Not displayed", "$0",
                                                       "$1-24,999", 
                                                       "$25,000-49,999", 
                                                       "$50,000-74,999",
                                                       "$75,000-99,999",
                                                       "$100,000+"))

# Rearrange order of Prosper rating since AA is better than A
spd$ProsperRating..Alpha. <- ordered(spd$ProsperRating..Alpha.,
                                     levels = c("AA","A", "B", "C", "D", 
                                                "E", "HR"))

# If the range of Credit scores exists calculate the mean of the Lower and 
# Upper Credit score for each borrower, otherwise set it to NA.

spd$CreditScoreMean <- ifelse(is.na(spd$CreditScoreRangeLower), NA, 
                              (spd$CreditScoreRangeLower +
                                 spd$CreditScoreRangeUpper)/2)

# For the rest of our analysis we only want to consider records with a 
# CreditScoreMean greater than 9.5 since during Univariate analysis
# we determined these records did not make any sense.  
spd <- subset(spd, CreditScoreMean > 9.5)

# Let's just select data with status code of either default or complete 
# and save that in a new dataframe for faster processing
spd.sts <- spd %>%
  filter((StatusCode == 0 | StatusCode == 8)) 

# and lets change it to a factor variable for displaying nicely on graphs
spd.sts$StatusCode <- factor(spd.sts$StatusCode, order = TRUE, levels = c(0, 8),
                             labels = c("Closed", "Defaulted"))



```
#Univariate Plots Section
Two additional variables were added in the above code to give 19 variables. 
```{r echo=FALSE, warning=FALSE, Loandate_plot, fig.height=3, fig.width=10}
# Set the color scheme for Defaulted(red) and Closed(navy blue) loans
# for spd.sts dataframe
g.colors <-  c("#000080", "red")
names(g.colors) <- levels(spd.sts$StatusCode)
col.scale <- scale_color_manual("StatusCode", values = g.colors)
fil.scale <- scale_fill_manual("StatusCode", values = g.colors)

dim(spd)
str(spd)
summary(spd)
qplot(x = LoanDate, data = spd, geom = "histogram", binwidth = 365, 
      color = I("black"), fill = I("blue")) 
```
The histogram of loan origination dates is skewed to the left indicating more loans have been funded recently  

```{r echo=FALSE, APR_plot, warning=FALSE, fig.height=3, fig.width=10}
qplot(x = BorrowerAPR, data = spd, binwidth = .05, color = I("black"), 
      fill = I("blue")) +
  scale_x_continuous(breaks = seq(0, 0.45, 0.05))

```
At first glance APR values appear to have a fairly symmetric, unimodal distribution  


```{r echo=FALSE, Loan_Amounts, fig.height=3, fig.width=10}
ggplot(aes(x = LoanOriginalAmount, color = I("black"), fill = I("blue")), 
       data = spd) + 
  geom_histogram(binwidth = 1000, boundary = 0) + 
  scale_x_continuous(limits = c(0, NA), breaks = seq(1000, 35000, 1000)) +
  theme(axis.text.x = element_text(angle = 90, vjust = .5))
```
Loan amounts are skewed to the right indicating higher loan amounts are less common.  


```{r echo=FALSE, loan_status, fig.width=10}
ggplot(aes(x = LoanStatus, color = I("black"), fill = I("blue")), data = spd) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90, vjust = .3)) 
table(spd$LoanStatus)

```
From the bar graph and table we see over 6,000 loans are in a default or charged off status  

```{r echo=FALSE, status_code, fig.width=10}
ggplot(aes(x = StatusCode, color = I("black"), fill = I("blue")), data = spd) +
  geom_bar() 
length(spd$StatusCode[spd$StatusCode == 8])/
  length(spd$StatusCode[spd$StatusCode == 8 | spd$StatusCode == 0])

```

This graph uses the newly created variable StatusCode where Loan Status values Completed & FinalPaymentinProgress were combined as were
Chargedoff and Defaulted. Approximately 24% of the finished loans are in a default status. 

```{r echo=FALSE, Homeowner, fig.height=3, fig.width=10}
ggplot(aes(x = IsBorrowerHomeowner, width = .8, fill = IsBorrowerHomeowner), 
       data = spd) +
  geom_bar(color = "black", fill = "blue", width = .5) +
  guides(fill = FALSE)

```
From this graph we can see about 10,000 more borrowers own homes than those who do not.  


```{r echo=FALSE, Income_Range, fig.height=3, fig.width=10}

qplot(x = IncomeRange, data = spd) +
  geom_bar(color = "black", fill = "blue")
```
It appears a majority of borrowers have income in the $25,000 to $75,000 range.  This is a self report field so 
the actual earnings may be different and we will need to keep this in mind when attempting to draw conclusions.  


```{r echo=FALSE, warning=FALSE, Prosper_Score, fig.height=3, fig.width=10}
ggplot(aes(x = ProsperRating..numeric., binwidth = 1), data = spd) +
  geom_bar(color = "black", fill = "blue") +
  scale_x_continuous(breaks = seq(0, 7, 1))
```
The distribution of scores determined by Prosper are symmetrical but with the mode, or most common score being 4. 
  
```{r echo=FALSE, Occupation_uni, fig.width=10}
qplot(x = Occupation, data = spd) +
  geom_bar(color = "black", fill = "blue") +
  theme(axis.text.x = element_text(angle = 90, vjust = .1)) 

```
Occupation is selected by the borrower at the time they created the listing which could account for the fact that "Other"
is the most common occupation.  


```{r echo=FALSE, Term, fig.height=3, fig.width=10}
ggplot(aes(x = Term), data = spd) +
  geom_bar(color = "black", fill = "blue") +
  scale_x_continuous(breaks = c(12, 36, 60), labels = c(12, 36, 60))
```
Three years or 36 months is the most common loan term length.  


```{r echo=FALSE, Listing_Category, fig.width=10}
reas.leg <- c("0 - Not Available", "1 - Debt Consolidation", 
              "2 - Home Improvement", "3- Business", "4 - Personal Loan",
              "5 - Student Use", "6 - Auto", "7 Other", "8 - Baby&Adoption",
              "9 - Boat", "10 - Cosmetic Procedure", "11 - Engagement Ring",
              "12 - Green Loans", "13 - Household Expenses", 
              "14 - Large Purchases", "15 - Medical/Dental", "16 - Motorcycle",
              "17 - RV", "18 - Taxes", "19 - Vacation", "20 - Wedding Loans") 

reas.counts <- table(spd$ListingCategory)
barplot(reas.counts, col="blue", border= "black",
        main = "Reason for Loan Request", xlab = "Reason", ylab = "Counts")

legend(x = "topright", title = "Reason for Loan", reas.leg, cex = .5)
```
Reason "Not Available" is the most common response.  I wonder if this will affect the APR rate assigned to the loan and will analyze later in
the bivariate analysis.  


```{r echo=FALSE, warning=FALSE, Credit_Scores, fig.height=3, fig.width=10}
ggplot(aes(x = CreditScoreRangeLower, y = CreditScoreRangeUpper), data = spd) +
  geom_jitter(alpha = 1/20, color = "#000080")

length(spd$CreditScoreRangeLower == 0 | is.na(spd$CreditScoreRangeUpper))
```
I realize this is technically a bivariate plot but I want to see if creating one variable from them is appropriate to to then create a univariate plot.  This scatterplot shows the Upper and Lower Credit Scores of individuals as reported by consumer credit rating agencies.  Since the pattern of these values form a line axis it indicates the reporting agencies return about the same score for individuals
with similar personal financial information.  Due to this it seems using the mean of these two scores is appropriate.    

```{r echo=FALSE, warning=FALSE, Credit_score.mean, fig.height=3, fig.width=10}

ggplot(aes(x = CreditScoreMean), data = spd) +
  geom_histogram(color = "black", fill = "blue", binwidth = 50) +
  coord_cartesian(xlim = c(400, 1000)) + 
  scale_x_continuous(breaks = seq(400, 1000, 50)) 
```
The graph showing the average credit score for each borrower is skewed somewhat to the right with a peak around 700.  

```{r echo=FALSE, warning = FALSE, CurrentCreditLines, fig.width=10}
ggplot(aes(x=CurrentCreditLines), data=spd) +
  geom_histogram(color = "black", fill = "blue", boundary = -.2, binwidth = 5)
```
  
At the time the credit profile was pulled most people had between 5 and 10 Current Credit Lines.  We can again see the data is skewed to the right
  

```{r echo=FALSE, warning=FALSE, Deliquencies, fig.width=10}
ggplot(aes(x = sqrt(CurrentDelinquencies)), data = spd) +
  geom_histogram(color = "black", fill = "blue", binwidth = 1, boundary =  0) + 
  coord_trans(y="sqrt")

table(spd$CurrentDelinquencies)
```
I took the square root of the number of Delinquencies and transformed the y scale by taking the square root.  The majority of borrower's had 0 delinquencies at the time of requesting a loan.  In rare cases we see 4 or more delinquencies.  Surprisingly we we see a borrowers with over 20 delinquencies.  It will be very interesting to see how delinquencies might relate to loan status.
  
```{r echo=FALSE, warning=FALSE, DebtToIncomeRatio, fig.width=10}
# entire graph, with out detail
ggplot(aes(DebtToIncomeRatio), data = subset(spd, !is.na(DebtToIncomeRatio))) +
  geom_histogram(color = "black", fill = "blue", binwidth = 1, boundary = -.5) +
  coord_cartesian(xlim = c(0, 10.25)) +
  theme(axis.text.x = element_text(angle = 90, vjust = .2)) +
  scale_x_continuous(breaks = seq(0, 10.25, 1)) 

summary(spd$DebtToIncomeRatio)
```
According to the Prosper documentation the possible value is capped at 10.01.  I decided to split the graph into two sections in order to zoom in on the values.  

```{r echo=FALSE, warning=FALSE, DebtToIncomeRatio_Zoom, fig.width=10}
# Now zoom in on graph from 0 to 1.5
z1 <- ggplot(aes(DebtToIncomeRatio), 
             data = subset(spd, !is.na(DebtToIncomeRatio))) +
  geom_histogram(color = "black", fill = "blue", binwidth = .05, 
                 boundary = -.5) +
  coord_cartesian(xlim = c(0, 1)) +
  theme(axis.text.x = element_text(angle = 90, vjust = .2)) +
  scale_x_continuous(breaks = seq(0, 1, .05)) +
  labs(title = "Debt to Income Ratios <= 1.5")

# Save the zoomed in plot for displaying side by side with the zoomed out plot
z2 <- ggplot(aes(DebtToIncomeRatio), 
             data = subset(spd, !is.na(DebtToIncomeRatio))) +
  geom_histogram(color = "black", fill = "blue", binwidth = .5,
                 boundary = -.5) +
  coord_cartesian(xlim = c(1.5, 10.75), ylim = c(0, 500)) +
  scale_x_continuous(breaks = seq(1.5, 10.75, .5)) + 
  scale_y_continuous(breaks = seq(0, 500, 100)) +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(title = "Debt to Income Ratios >= 1.5")

grid.arrange(z1, z2, ncol = 2)
```
The most common debt to income ratio is between .15 and .20.  I find it quite interesting that the Debt to Income ratio from 0 to 0.5 almost fits the normal model.  It is quite unusual for borrowers to have a ratio above .5.  

# Univariate Analysis

### What is the structure of your dataset?

There were 113,937 loans in the dataset with 81 variables.  I considered a subset of the variables(Term, LoanStatus, BorrowerAPR, ProsperRating..numeric., ProsperRating..alpha., ListingCategory..numeric.,Occupation, IsBorrowerHomeowner, CreditScoreRangeLower, CreditScoreRangeUpper, CurrentCreditLines, CurrentDelinquencies, DebtToIncomeRatio, IncomeRange, LoanOriginalAmount, LoanOriginationDate) and excluded any records that had a loan status of "Cancelled"or did not have a prosper rating.  This resulted in 84,853 loans left for analysis.  

In the original dataset LoanStatus, Occupation, IsBorrowerHomeowner, IncomeRange, and LoanOriginationDate were all factor variables.  LoanStatus and IncomeRange were not ordered and I decided to apply an order to them which is reflected below along with the factors of the other variables.     

**LoanStatus - Ordered**
"Completed", "FinalPaymentInProgress", "Current", "Past Due (1-15 days)", "Past Due (16-30 days)", "Past Due (31-60 days)", "Past Due (61-90 days)", "Past Due (91-120 days)", "Past Due (>120 days)", "Chargedoff", "Defaulted"  


**Occupation, 68 levels - no Order**  

|             Occupations             |             Occupations            |          Occupations          |
| ----------------------------------- | ---------------------------------- | ----------------------------- |
| '' |Accountant/CPA| Administrative Assistant|
| Analyst|Architect|Attorney|
| Biologist|Bus Driver|Car Dealer|
| Chemist|  Civil Service | Clergy |
| Clerical|  Computer Programmer | Construction |                   
| Dentist|  Doctor |  Engineer - Chemical |
| Engineer - Electrical| Engineer - Mechanical | Executive |
| Fireman | Flight Attendant                   |  Food Service |
| Food Service Management             |  Homemaker | Investor |
| Judge                               |  Laborer |  Landscaping                  |
| Medical Technician                  |  Military Enlisted |  Military Officer             |
| Nurse's Aide                        |  Nurse (LPN)                        |  Nurse (RN)                   |
| Other                               |  Pharmacist                         |  Pilot - Private/Commercial   |
| Police Officer/Correction Officer   |  Postal Service                     |  Principal                    |
| Professional                        |  Professor                          |  Psychologist                 |
| Realtor                             |  Religious                          |  Retail Management            |
| Sales - Commission                  |  Sales - Retail                     |  Scientist                    |
| Skilled Labor                       |  Social Worker                      |  Student - College Freshman   |
| Student - College Graduate Student  |  Student - College Junior           |  Student - College Senior     |
| Student - College Sophomore         |  Student - Community College        |  Student - Technical School   |
| Teacher                             |  Teacher's Aide                     |  Tradesman - Carpenter        |
| Tradesman - Electrician             |  Tradesman - Mechanic               |  Tradesman - Plumber          |
| Truck Driver | Waiter/Waitress|  |  


**IsBorrowerHomewowner**
"False", "True"

**IncomeRange - Ordered**
"Not employed", "Not displayed", "$0", "$1-24,999", "$25,000-49,999", "$50,000-74,999", "$75,000-99,999", "$100,000+"  

**LoanOriginationDate**
Factor variable which was not particularly useful for my analysis so I created the new variable LoanDate using this data.  Please
see below for additional information.


### What is/are the main feature(s) of interest in your dataset?
The main features in the data set are ProsperRating..numeric. and Loan Status.  I hope to determine which features are best for predicting if the loan associated with a borrower's loan status.  Since Prosper provides a service to both borrowers and investors it would be useful for investors to be able to predict which loans are most likely to be completed.  Prosper's website for available loans to invest in gives the Loan Category which is character value corresponding to ProsperRating..numeric.  AA or numerically 7 is the best rating with HR(i.e. 1) the worst.  This field is only applicable for loans originated after July 2009.  In order to see what other information is available regarding the borrower's particulars you must register as an investor with Prosper.  It will be intersting to see if the Prosper Score is truly the best predictor or if other features are better.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
APR, Occupation, Listing Category, IsBorrowerHomeowner, Credit Scores, CurrentDelinquencies, DebtToIncomeRatio, and IncomeRange are potential indicators of whether or not a loan will end in default or charge off.

### Did you create any new variables from existing variables in the dataset?
I used the variable LoanOriginationDate to create the variable **LoanDate** which is a date variable in YYYY-MM-DD format.  The original variable was a factor variable and contained a timestamp as well which is not useful for my analysis.

LoanStatus was used to create the variable **StatusCode**, a numeric field in dataframe SPD, which I consider to be my primary response(dependent) variable.  I considered Completed & FinalPaymentinProgress essentially the same status but due to timing are in different categories and assigned 0 to StatusCode.  The same is true of Chargedoff and Defaulted so they were assigned status code 8.

**CreditScoreMean** was created by taking the average of a borrower's CreditScoreRangeLower and CreditScoreRangeUpper.  Multiple agencies may be contacted for a borrower's credit scrore.  During the Univariate section I did do a scatterplot of these two scores which I know is bivariate analysis.  I thought this was the appropriate time to see what the relationship was between these two scores so that I would know which one to use during the true bivariate analysis phase when comparing Credit Score to Loan Status.  Since their relationship was linear it seemed appropriate to use the average of Lower and Upper Credit Scores.

***spd.sts*** is a dataframe which is a subset of spd and includes only records that are in a default(8) or closed(1) status.  I then changed the StatusCode in this dataframe to a factor variable with two levels.  This file is used in the bivariate and multivariate analysis.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
I did use lubridate to create the new field Loan Date to make this feature more useful as a time stamp if not necessary for my analysis. 

For the number of delinquencies to standout graphically I decided to take the square root of both the CurrentDelinquencies and y scale.

I thought it was interesting that the number of homeowners and non-homeowners is about the same. It will be interesting to see if one or the other is more likely to default on a loan.

------

# Bivariate Plots Section
```{r echo=FALSE, warning=FALSE, Bivariate_Plots}
GraphScat <- function(xvar) {
  # Creates the first layer of the a scatterplot to avoid
  # redundant code. 
  # 
  # Args:
  #   xvar is the explanatory variable,
  #
  # Returns:  1st layer of the scatterplot
  # 
  # Notes:  shQuote ensures a character value is passed back to color & 
  #         the use of guide is to turn off the legend

  g1 <- ggplot(aes_string(x = xvar , y = "StatusCode",
                          color = shQuote("s_color")), data = spd) +
    scale_color_manual(values = c("#000080"), guide = FALSE)
  return(g1) 
}
GraphScat("ProsperRating..numeric.") +
  geom_jitter()
cor.test(spd$ProsperRating..numeric., spd$StatusCode)
```
  
There is not a linear relationship between Prosper Risk Rating and the status of a loan as indicated by the correlation coefficient of -.19 as well as the plot.  Let's see if a stronger relationship between other variables exists.

```{r echo=FALSE, warning=FALSE, correlations}
# get just the numeric variables I believe are related to Status Code 
spd.num <- subset(spd, select = c(BorrowerAPR, ProsperRating..numeric.,
                                  ListingCategory..numeric., CurrentCreditLines,
                                  CurrentDelinquencies, DebtToIncomeRatio,
                                  LoanOriginalAmount, StatusCode, 
                                  CreditScoreMean))

cor(spd.num, use = "pairwise.complete.obs") 
```
    
The correlation between the loan risk rating assigned by Prosper and the offered APR is quite strong with r = -.96.  This is not surprising since one would expect borrowers with good(high ratings) credit history to be offered a lower APR than one who presents as bad risk(low rating)  Additionally it appears that the APR in turn has a slightly stronger relationship r = .22 with loan status code than the Prosper rating. I wonder how allowing for the categorical variables affects the relationship. 
```{r echo=FALSE, warning=FALSE, Sample_Relationships, fig.width=10}
set.seed(5)
corrplot(cor(spd.num[sample.int(nrow(spd.num),1000),]), method = "number",
         na.label = "NA", type = "lower", tl.col = "blue", number.cex = .8)
```
  
Proper Risk Rating and Credit Score Mean are only moderately correlated with r = .55.  This indicates Prosper does not use only Credit Scores to determine the risk rating of a loan 

I want to look closer at scatter plots involving Status Code as it relates to Debt/Income, Number of Credit Lines, Reason, Number of Delinquencies, and Mean Credit Score.  I don't believe we will see much of a linear relationship but it will let me get quick idea of where values are clustered.
```{r echo=FALSE, warning=FALSE, bivariate_data_file, fig.width = 10}

GraphScat("DebtToIncomeRatio") +
  geom_jitter(alpha = 1/10) +
  scale_x_continuous(breaks = seq(0, 10, 1)) + 
  scale_y_continuous(breaks = seq(0, 8, 1))

# zoom in to see if there is a debt to income ratio where defaults/late payments 
# increase
GraphScat("DebtToIncomeRatio") +
  geom_jitter(alpha = 1/30) +
  coord_cartesian(xlim = c(0, .5), ylim=c(0, 8)) +
  scale_x_continuous(breaks = seq(0, .5, .05)) +
  scale_y_continuous(breaks = seq(0, 8, 1))

with(subset(spd, DebtToIncomeRatio <= .5), table(round(DebtToIncomeRatio,
                                                       digits = 2),
                                                 StatusCode), 10)
```
    
Between .05 and .35 we see an increase in the number of defaults and late payments. 

```{r echo=FALSE, warning=FALSE, StatusCode_vs_CurrentDelinquencies, fig.width = 10}
GraphScat("CurrentDelinquencies") +
  geom_jitter(alpha = 1/10)
```
  
This doesn't give me much information about how the number of Current Delinquencies at the time the profile was pulled affects default status.  I want to zoom in to see if their is a number range that might indicate a borrower will default.  
```{r echo=FALSE, warning=FALSE, StatusCode_vs_CurrentDelinquenciesZoom, fig.width = 10}
GraphScat("CurrentDelinquencies") +
  geom_jitter(alpha = 1/10) +
  coord_cartesian(xlim = c(0, 10), ylim=c(0, 8)) +
  scale_x_continuous(breaks = seq(0, 10, 1)) +
  scale_y_continuous(breaks = seq(0, 8, 1))

# Let's just zoom in on a section of the table too.
with(subset(spd, CurrentDelinquencies <= 10), table(CurrentDelinquencies, 
                                                    StatusCode))
```
  
From the graph and table at and above 0 Delinquencies the difference between the number of Completed vs Defaulted loans begins to decrease.  

```{r echo=FALSE, warning=FALSE, StatusCode_vs_CurrentCreditLines, fig.width = 10}
# just show a subset since # of possible credit lines exceeds 80
with(subset(spd, CurrentCreditLines < 24), table(StatusCode,
                                                 CurrentCreditLines))
GraphScat("CurrentCreditLines") +
  geom_jitter(alpha = 1/10)
```
  
Now this is quite interesting.  For borrower's with 0 & 1 credit lines a similar number of defaults compared to complete loans.  And then as the number of credit lines increases a great deal more completed loans than defaulted. So it seems having existing credit lines is a slight indication that the loan will be completed rather than defaulted.  

```{r echo=FALSE, warning=FALSE, StatusCode_vs_CreditScoreMean, fig.width = 10} 
GraphScat("CreditScoreMean") +
  geom_jitter(alpha = 1/10)
```
  
For borrower's with credit scores near 600 about the same number of borrower's defaulting vs borrower's completing their loans while for those above 600 more do complete their loan but quite a few people with scores between 650 and 750 default.

```{r echo=FALSE, warning=FALSE, StatusCode_vs_ListingCategory, fig.width = 10}
GraphScat("ListingCategory..numeric.") +
  geom_jitter(alpha = 1/20) +
  scale_x_continuous(breaks = seq(0, 20, 1))

print("Reason x Status Code table below")
reas.tab <- table(spd$ListingCategory..numeric., spd$StatusCode)
round(prop.table(reas.tab, 1), 2)
table(spd$ListingCategory..numeric., spd$StatusCode)
```
  
The most common reason code is 1(Loan Consolidation) yet uthas a lower percentage of defaulted loans than reason code 5 which has 16% of it's loans in a default status.  I'm probably not going to pursue whether or not Listing Category affects loan status any further as this self select category and the borrower may not be giving the true purpose of the loan.
  
```{r echo=FALSE, warning=FALSE, StatusCode_vs_LoanDate, fig.width = 10}
# is there a loan year where defaulting was more likely
summary(spd$LoanDate)

ggplot(aes(as.numeric(format(LoanDate, "%y")), StatusCode), 
       data = subset(spd, CreditScoreMean > 250))+
  geom_jitter(alpha = 1/20, color = I("#000080")) +
  scale_x_continuous(breaks = seq(6, 14, 1), labels = c("2006", "2007", "2008",
                                                        "2009", "2010", "2011", 
                                                        "2012", "2013", "2014")) 
  
```
  
Loans with an origination date of 2011 and later could still have been in progress as of 2014(as indicated by loan status 1-7) so the final outcome of the loan(i.e. Completed or Defaulted) is unknown.  I am not going to do further analysis on year and Loan Status I just wanted to see the yearly trend for completion vs. default.
  
```{r echo=FALSE, warning=FALSE, StatusvsDebtMean, fig.width = 10}
# Create a dataframe to look at the relationship between status and the means of
# the data 
spdSumm <- spd %>%
  group_by(StatusCode) %>%
  summarise(debt.mean = mean(DebtToIncomeRatio, na.rm = TRUE), 
            apr.mean = mean(BorrowerAPR, na.rm = TRUE), 
            rat.mean = mean(ProsperRating..numeric.), 
            score.mean = mean(CreditScoreMean, na.rm = TRUE))

ggplot(aes(debt.mean, StatusCode), data = spdSumm) +
  geom_point()
print("Correlation between Status Code and Mean Debt") 
cor(spdSumm$StatusCode, spdSumm$debt.mean)
```
  
Status Code vs. DebtToIncomeRatio Mean graph shows reasonable scatter from which a linear model could be created &  positive correlation of .41 indicating a slight positive linear relationship

```{r echo=FALSE, warning=FALSE, APRmean, fig.width = 10}

ggplot(aes(apr.mean, StatusCode), data = spdSumm) +
  geom_point() +
  geom_smooth(method = "lm", color = 'green')
print("Correlation betweeen Status Code and APR mean")
cor(spdSumm$StatusCode, spdSumm$apr.mean)
print("Mean Borrower's APR")
mean(spd$BorrowerAPR, na.rm = TRUE)
```
    
Since our univariate analysis showed that the Borrower's APR was fairly symmetrical with a single peak near the center of the data it is realistic to use the mean of .23 as the center of the distribution.  That combined with the fact that Status Code and the APR's mean have a  strong correlation with r = .86 it appears that, for this data, the higher the borrower's APR is above the mean of .23 the more likely the borrower had late payments or defaulted.  

```{r echo= FALSE, warning=FALSE, Ratingmean, fig.width = 10}
ggplot(aes(rat.mean, StatusCode), data = spdSumm) +
  geom_point() +
  geom_smooth(method = "lm", color = 'green')
print("Corrrelation betweeen Status Code and Prosper Rating Mean")
cor(spdSumm$StatusCode, spdSumm$rat.mean)
print("Mean Prosper Rating")
mean(spd$ProsperRating..numeric.)
```
  
The relationship between Prosper Rating mean vs Status code is strong and negative (-.84).  In other words the lower the prosper rating the more likely borrower's had loans that were in a late or defaulted status.

```{r echo= FALSE, warning=FALSE, CreditScoremean, fig.width = 10}
ggplot(aes(score.mean, StatusCode), data = spdSumm) +
  geom_jitter() +
  geom_smooth(method = "lm", color = 'green')
print("Corrrelation betweeen Status Code and Credit Score Mean")
cor(spdSumm$StatusCode, spdSumm$score.mean)
print("Mean Credit Score")
mean(spd$CreditScoreMean, na.rm = TRUE)
```

The relationship between Credit Score Mean vs Status Code is moderately strong and negative with r = -.61.   Credit Score used in conjunction with the Prosper Rating could help an investor select loans most likely to end up closed rather than defaulted.  Most points are clustered around 698.    

```{r echo_FALSE, WARNING=FALSE, fig.width=10}
dim(spd.sts)
table(spd.sts$StatusCode)
```
For the rest of the analysis I'm only interested in Status Code 0 & 8.  What will happen with Statuscodes 1-7 is unknown as they are in progress.  This means I am now treating Status Code as a qualitative variable.  Reducing the data set gives me 26,210 records for analysis.  6,341 of theses are in a default status.  

```{r echo=FALSE, warning=FALSE, Counts, fig.width = 10}
# contains the variable name for which quartiles are to be calculated
GraphBox <- function(yvar) {
  # Creates the first layer of vertical boxplots. 
  # 
  # Args:
  #   yvar: string containing variable to display on teh vertical axis
  #
  # Returns:
  # The first layer of the box plot
  
  g1 <- ggplot(aes_string(x = "StatusCode", y = yvar), data = spd.sts) +
    geom_boxplot() 
  return(g1) 
}

GraphBox("BorrowerAPR") + 
  coord_cartesian() +
  stat_summary(fun.y = mean, geom = 'point', shape = 2)

GraphBox("ProsperRating..numeric.") + 
  coord_cartesian() +
  stat_summary(fun.y = mean, geom = 'point', shape = 2)
```
  
The above two box plots examine APR and Prosper Rating for closed and defaulted loans.
  
The borrower's APR 50th percentile is approximately 25% for completed loans while it is at about 30% for defaulted loans.  Note the triangle on the graphs represents the mean of each.  Since these medians and means are different this could be an indication that knowing a borrower's APR in addition to Prosper Rating could be useful. 
  
Similarly the Prosper Rating's 50th percentile is four for completed loans while for defaulted loans it is three and 75% of borrower's who default on a loan have a Prosper Rating of four or less.
  
```{r echo=FALSE, warning=FALSE, StatusCode_vs_Delinquencies, fig.width = 10}
GraphBox("CurrentDelinquencies") + 
  coord_cartesian(ylim = c(0, 5)) +
  scale_y_continuous(breaks = seq (0, 5, 1))

del.tab <- with(subset(spd.sts, CurrentDelinquencies <= 10), 
                table(StatusCode, CurrentDelinquencies))
round(prop.table(del.tab, 2), 2)
```
The distributions of Current Delinquencies are quite similar for completed and defaulted loans.  They both share the same 75th percentile of 0. 
Outliers exist at 1 & up so I decided to focus on them. Borrower's with one or more delinquencies have a greater percent of defaults compared to those with 0 delinquencies.  For example for borrower's with just 1 delinquency the default rate is about 31% but for those with 0 delienquencies the default rate is about 22%.
  
```{r echo=FALSE, warning=FALSE, ConditionalRatio, fig.width = 10 }
DecFormatter <- function(lab) {
  # Removes leading 0 from the graph
  #
  # Args:
  #   y: the value to be formatted
  
  lab <- as.character(lab)  # Convert to character
  lab <- gsub("^0", "", lab)  # Remove the leading 0 
}

GraphBox("DebtToIncomeRatio") +
  coord_cartesian(ylim = c(0, .5)) +
  scale_y_continuous(breaks = seq(0, .5, .02), label = DecFormatter)
```
  
Outliers with values between .5 and 10 exist for both closed and defaulted loans but don't occur with high frequency.  I am zooming in on debt to income ratios between 0 and .5
For loans in a closed status 75% of borrowers had a Debt to Income Ratio of .29 or less while for loans in a Defaulted Status 75% of borrowers had a Debt to Income Ratio of .34.  The difference between medians of the two status is only 5% but it does appear that having a lower debt to Income Ratio may be related to Status.  

```{r echo=FALSE, warning=FALSE, ConditionalMean, fig.width = 10}
GraphBox("CreditScoreMean") + coord_cartesian()
summary(spd.sts$CreditScoreMean[spd.sts$StatusCode == "Closed"])
summary(spd.sts$CreditScoreMean[spd.sts$StatusCode == "Defaulted"]) 
```
75% of borrowers with closed loans had a mean credit score of 750 or less while for defaulted loans the 75th percentile is about 730.  
While a difference of 20 points does not seems important perhaps it is large enough to indicate a relationship between Credit Score Mean and Loan Status.  
  
```{r echo=FALSE, warning=FALSE, Conditionals, fig.width = 10}

GraphBox("CurrentCreditLines") + coord_cartesian() 

GraphBox("ListingCategory..numeric.") + coord_cartesian() 

GraphBox("LoanOriginalAmount") + coord_cartesian()

```
  
Current Credit Lines, Reason(ie. Listing Category), and Original Loan Amount have similar distributions for both completed and defaulted loans so it does not appear that their is a relationship between them and default status.  
```{r echo=FALSE, warning = FALSE, GetGroup, fig.width=10}
GetGroup <- function(grp.var) {
  # Produce a dataframe from theglobal dataframe spd.sts grouped by the desired
  # variable
  # 
  # Args:
  #   grp.var: variable to group by
  #
  # Returns:
  #   Data frame grouped appropriately

  gdf<- spd.sts %>%
  group_by_("StatusCode", grp.var) %>%
  summarise(counts = n())
  return(gdf)
}

```
```{r echo=FALSE, warning = FALSE, byHomeOwner}
bho <- GetGroup("IsBorrowerHomeowner")
# different data frame so not using fil.scale
ggplot(aes( x = IsBorrowerHomeowner, y = counts), data = bho) +
  geom_bar(stat = "identity", aes(fill = StatusCode)) +
  scale_fill_manual(values = c("#000080", "red"))       
```
  
Whether or not someone is a homeowner does not seem to impact whether or not they will default on a loan.  Approximately the same number of homeowners and non homeowners have loans in closed status and while non homeowners may have defaulted on loans in greater number it is not by that much as depicted in the graph.  

```{r echo=FALSE, warning=FALSE, Occupation, fig.width=10}

odf <- GetGroup("Occupation")

# different data frame so not using fil.scale
ggplot(aes( x = Occupation, y = counts), data = odf) +
  geom_bar(stat = "identity", aes(fill = StatusCode)) +
  scale_fill_manual(values = c("#000080", "red")) +
  theme(axis.text.x = element_text(angle = 90, vjust = .5))

```
  
Again this is a self selected category and no Occupation stands out more than another as having more or less defaults compared to closed.  It doesn't appear a relationship exists between Status Code and Occupation.
# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?  
slight differences in Debt to Income Ratio, Credit Score, and number of delinquencies for closed vs. defaulted loans exist.  I was hoping to find a more dramatic relationship but nothing is standing out yet.  Perhaps a variable will stand out more in the multivariate analysis.
  
### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?  
During this analysis it became clear that I could not treat Loan Status as a quantitative variable and decided to just focus on closed vs defaulted status. What is most surprising is the seemingly lack of a strong relationship.  For example the distribution between home owners/non owners and whether a person defaulted on a loan is about the same.  I started this project believing homeowers would be more likely to complete loans than non-homeowners which was an incorrect assumption.

### What was the strongest relationship you found?  
The strongest linear relationship is between Prosper Rating Mean vs. Status Code but a linear model here just doesn't seem appropriate.   Treating Status code as a qualitative(Closed vs Default) variable I am seeing a strong relationship between Status Code vs Borrower's APR as indicated by the box plots and scatterplot of Status code vs. Borrower's APR mean.  

------

# Multivariate Plots Section
For this section I have decided to just work with the dataframe containing status code 0 (Loan in Closed Status or pending closure) and status code 8 (Defaulted).  Also please note that numeric Prosper Ratings range from 1(Higher Risk - "HR") to 7(Lower Risk - "AA")  

```{r echo=FALSE, warning=FALSE, Densities, fig.width = 10}

# Prosper rating is the benchmark.  Looking for other indicators rather than 
# just trusting Prosper.
GraphDen <- function(xvar) {
  # Handles most of the graphing parameters for the density graphs
  #
  # Args:
  #   xvar: variable to display on the x-axis
  #
  # Returns:
  #   1st layer of the Density plot
  gd <- ggplot(aes_string(x = xvar, color = "StatusCode", fill = "StatusCode"),
               data = spd.sts) +
    geom_density(alpha = .3) + 
    col.scale +  fil.scale 
  return(gd)
}

GraphDen("ProsperRating..numeric.") +
  coord_cartesian(xlim = c(0, 9)) +  
  scale_x_continuous(breaks = seq(0, 9, 1))

GraphDen("CurrentDelinquencies") +
    coord_cartesian(xlim = c(0,4))

GraphDen("CurrentCreditLines") +
  coord_cartesian(xlim = c(0, 40))
  
GraphDen("DebtToIncomeRatio") +
  coord_cartesian(xlim = c(0, 1)) +
  scale_x_continuous(breaks = seq(0, 1, .1))

GraphDen("BorrowerAPR") +
  coord_cartesian()

GraphDen("CreditScoreMean") +
  coord_cartesian(xlim = c(400, 900)) +
  scale_x_continuous(breaks = seq(400, 900, 100))


```
   
The Prosper Rating density graph makes it very clear that investing in a loan that has been rated below 4 is a risky investment but I want to see what else might help us predict the likelihood of a borrower defaulting. 
  
For borrowers with zero Delinquencies, the percent of closed loans is greater than defaulted but as soon as 1 or more delinquencies are found, loans in default status are almost equal to those in closed. 

Borrowers with 0 to 5 credit lines actually have more loans in a default status and those with 5 to about 18 have more loans in a close status but these densities are similar and have significant overlap. 

The distributions of Debt to Income Ratio's for Closed and Defaulted loans also have very similar shapes.  Borrower's with a Debt To Income Ratio between approximately 5% and 25% have a greater number of loans in closed status and then once the Debt To Income Ratio exceeds 25% the occurrence of defaulted loans is greater than closed loans.  

An APR of 25% seems to be a tipping point for the likelihood of a loan being in default status.  Below 25% more loans are closed than defaulted.  Above 25% and defaults are more common.

The last density indicates borrowers with a credit score less than approximately 710 had a greater percentage of loans in a default status



```{r echo=FALSE, warning=FALSE, GraphViolFunction, fig.width = 10}
GraphViol <- function(yvar) {
  # This function handles building the bulk of each violin plot
  #
  # Args:
  #   yvar: variable to display on the vertical axis of the violin plot
  # 
  # Returns:
  #   1st layer of the graph
  
    gv <- ggplot(aes_string(x = "StatusCode", y = yvar), data = spd.sts) + 
    geom_violin(aes(fill = StatusCode)) + 
    facet_wrap(~ProsperRating..Alpha., nrow = 2) +
    fil.scale
  return(gv) 
}

```
```{r echo=FALSE, warning=FALSE, SumFunction, fig.width = 10}
kSumBy <- "~ ProsperRating..Alpha. + StatusCode"
SumFun <- function(sum.var) {
  # Handles formatting & printing the 5 number summary associated with each of 
  # the violin plots.
  #
  # Args:
  #   sum.var: the variable to be summarized
  #
  # Returns:
  #   N/A
  sum.form <- formula(paste(sum.var, kSumBy, sep=""))
  # save the 5 number summary in order to change variable names for prettier
  # output
  five.sum <- summaryBy(sum.form, data=spd.sts, FUN = summary)
  names(five.sum)[1:8] <- c("Rating", "StatusCode", "Min", "Q1", "Median", 
                            "Mean", "Q3", "Max")
  five.sum
}

```
```{r echo=FALSE, warning=FALSE, CreditLinesViolin, fig.width = 10}
# Facet by Prosper Rating to see if know exact number of open credit lines is 
# useful
GraphViol("CurrentCreditLines") + geom_boxplot(width = .2, fill = "lightgreen")
SumFun("CurrentCreditLines")
```

  
Since the above distributions are so similar knowing the number of current credit lines on top of Prosper Rating does not give us any more information about whether or not the borrower will have a loan in a default status


```{r echo=FALSE, warning=FALSE, DebtToIncomeViolin, fig.width = 10}
GraphViol("DebtToIncomeRatio") +   scale_y_continuous(breaks = seq(0, 1, .1)) +
  geom_boxplot(width = .2, fill = "lightgreen") +
  coord_cartesian(ylim = c(0, 1)) 

# save the 5 number summary in order to change variable names for prettier 
# output
SumFun("DebtToIncomeRatio")

```
  
Debt To Income ratio gives a bit more information.  It appears not all loans given "AA" ratings are equivalent.  The medians differ by 5% and the 3rd quartiles by 6%.  With the exception of rating "AA" the medians are quite similar for "Closed" & "Defaulted" in each of the Prosper Ratings.  A bit more difference exists between the 3rd Quartiles(75th Percentile) for "EE", and "HR". This indicates to me that knowing the DebtToIncome ratio of borrower and the median Debt to Income ratio of all closed loans for each Rating would be very useful.  
  
```{r echo=FALSE, warning=FALSE, CurrentDelinquenciesViolin, fig.width = 10}
GraphViol("CurrentDelinquencies") + 
  scale_y_continuous(breaks = seq(0, 5, 1)) +
  coord_cartesian(ylim = c(0,5)) 

# Now let's also do a bar graph here to see if additional information can be
# captured
ggplot(aes(x = CurrentDelinquencies, fill = StatusCode), data = spd.sts) +
  geom_bar(position="fill") +
  coord_cartesian(xlim = c(0,5)) +
  scale_fill_manual(values = c("#000080", "red")) +
  facet_wrap(~ProsperRating..Alpha., nrow = 2) 

SumFun("CurrentDelinquencies")

```
Because number of delinquencies are clustered around 0 & 1 I wanted to see a barchart in addition to the boxplots.
With the exception of the "HR" rating, borrower's with 0 delinquencies have more closed loans than defaulted across ratings.  As soon as 1 delinquency is found the percentage in a default status exceeds those in closed.  Just having access to whether or not a borrower has any delinquencies exist may be useful.   
  
```{r echo=FALSE, warning=FALSE, CreditScoreViolin, fig.width = 10}
GraphViol("CreditScoreMean") + 
  scale_y_continuous(breaks = seq(500, 900, 25)) +
  geom_boxplot(width = .2, fill = "lightgreen") 

SumFun("CreditScoreMean")

```

This one shows for "AA" ratings median score differs by about 20 points with closed loans being higher, yet for "C" Prosper Ratings the median Credit score is actually higher for loans in a default status.  For the other Prosper Ratings the distributions for closed & defaulted distributions are fairly similar.


```{r echo=FALSE, warning=FALSE, BorrowerAPRViolin, fig.width = 10}
GraphViol("BorrowerAPR") + 
  coord_cartesian(ylim = c(.05, .45)) +
  scale_y_continuous(breaks = seq(.05, .45, .1)) +
  geom_boxplot(width = .2, fill = "lightgreen") 

SumFun("BorrowerAPR")

```
The plot that stands out the most is for "AA".  A greater percentage of loans are in a default status when the APR rate is higher, even by just a percentage point.  The median for those in a default status is about 9.7% while for those in closed is about 8.3%.  The 3rd quartiles differ by 2%  Having access to the borrower's APR and the median APR rate for closed loans as a reference point would be useful for investors.

```{r echo=FALSE, Warning = FALSE, HomeownRating, fig.width = 10}
ggplot(aes(x = IsBorrowerHomeowner, fill = StatusCode), data = spd.sts) +
  geom_bar(position="fill") +
  scale_fill_manual(values = c("#000080", "red")) +
  facet_wrap(~ProsperRating..Alpha., nrow = 2)

```
Once again it does not appear that being a homeowner influences status of the loan.  


# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?
Certainly taking into account the Prosper Rating in conjunction with the loan status of closed or defaulted helped to better identify variables which may help predict whether or not a borrower will default on a given loan.  Besides the risk rating assigned by Prosper also knowing a borrower's Mean Credit Score, Debt To Income Ratio, and whether or not the borrower has any delinquencies reported would be helpful to investor's when trying to determine which loans they wish to fund in order to gain the most profit.  Of course for these values to be useful investor's would also need the corresponding information for all closed loans to use as a reference point.

### Were there any interesting or surprising interactions between features?
The density graph of number of delinquencies hilited that even if a person has only one delinquency it can affect the ultimate loan status. I was surprised to see when faceting by Prosper risk rating that their rating system seems to reflect this.  While prosper rating does seem fairly accurate knowing a bit more of  the details and paying attention to seemingly small differences in financial information an investor may increase their chances of selecting a loan that is more likely to result in closure.

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.
I did not create any models.

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One, fig.width=10}
ggplot(aes(x = ProsperRating..numeric., y = StatusCode), data = spd) +
  geom_jitter(alpha = 1/20, color = "#000080") +
  guides(fill = FALSE) +
  scale_x_continuous(breaks = seq(1, 7), labels = c("1-Higher Risk", "2", "3", 
                                                    "4", "5", "6",
                                                    "7-Lower Risk")) +
  scale_y_continuous(breaks = seq(0, 8), labels = c("0, Closed", "1, Current", 
                                                    "2, >1", "3, >15", "4, >30", 
                                                    "5, >60", "6, >90", 
                                                    "7, >120", "8, Default")) +
  labs(title = "Loan Status vs Prosper Rating", x = "Prosper Risk Rating", 
       y = "Loan Status")

```

### Description One
While Prosper Risk Rating and Loan status are not linearly correlated the number of observations decreases overall as the rating increases from higher risk(0) to lower risk(7).  Since lower risk ratings with defaults and late payments exist I tried to identify other features that may help predict whether or not a loan will be defaulted on.

### Plot Two
```{r echo=FALSE, Plot_Two, fig.width=10}
ggplot(aes(x= StatusCode, y = CreditScoreMean), data = spd.sts) + 
  scale_y_continuous(breaks = seq(500, 900, 20)) +
  labs(title = "Status vs Credit Score - faceted by Rating ", 
       y = "Credit Score") +
  geom_violin(aes(fill = StatusCode)) + 
  geom_boxplot(width = .2, fill = "#D6DBDF") +
  facet_wrap(~ProsperRating..Alpha., nrow = 1) +
  fil.scale +
  guides(fill = FALSE)

```

### Description Two
The rating for which knowing the borrower's Credit Score seems most critical is "AA", Prosper's highest rating.  For "AA" closed loans the 75th percentile is about 20 points higher than for defaulted loans. The same is true of the medians.  This tells me that an investor selecting a "AA" rating should also select a loan whose borrower has a credit score of 810 or higher to help increase the chance of a closed loan.  The other rating with a strange anomaly is "C".  While the 75th percentiles are about the same the median of closed loans is actually about 20 points less than for defaulted loans. 

### Plot Three
```{r echo=FALSE, Plot_Three, fig.width=10}
ggplot(aes(x = CurrentDelinquencies, fill = StatusCode), data = spd.sts) +
  geom_bar(position="fill") +
  coord_cartesian(xlim = c(0,5)) +
  scale_y_continuous(breaks = seq(0, 1, .10), lab = DecFormatter) +
  scale_fill_manual(values = c("#000080", "red")) +
  facet_wrap(~ProsperRating..Alpha., nrow = 2) +
  labs(x = "Number of Delinquencies", y = "Relative Frequency", title = 
         "Relative Frequency of Closed vs Defaulted by Rating")
```

### Description Three
About 95% of "AA" rated loans result in a closed status if a borrower has zero delinquencies and if they have one delinquency about 85% of loans
result in closed.  Interestingly if they had three or four, 100% of the loans were closed.  This indicates to me that Prosper's calculation for assigning their rating does a good job taking into account delinquencies.  

------

# Reflection
Prosper provides a risk rating on a scale from HR(higher risk, 1) to AA(lower risk, 7) to help investors select an investment.  I wanted to see if there were other financial indicators associated with a borrower that influenced loan status.  As I progressed through the analysis it became apparent that treating loan status as a quantitative variable was not appropriate and I changed my focus to examining which variables might have the biggest affect on a loan be defaulted on vs. closed.   

I was surprised that overall the Prosper Rating by itself is a very reasonable predictor and had to look carefully for subtleties that in conjunction with the rating might help predict the completion or default of a loan.  At first I thought a borrower having any delinquencies was a definite indicator but as I looked more carefully at the data and took a subset of the data to only include records with a prosper rating which was added in 2009, I saw that the risk rating does seem to take delinquencies into account in the formula for calculating AA.  My analysis indicates knowing the borrower's APR and Credit Score and associated medians for closed AA ratings could be useful in selecting a loan that has a greater chance of being closed.  For all ratings knowing the borrower's debt to income ratio could also help an investor select a loan that is more likely to be closed.  

Future work could include actually doing analysis of variance(ANOVA) to help determine which of the predictor variables, Debt to income ratio, APR, or Credit Score has the greatest influence on loan default.  For example the proportion of borrowers who default given the loan has an APR of .23 or less to the proportion of borrowers who default given the loan has an APR greater than .23 could be compared. 
